// SPDX-License-Identifier: Apache-2.0

/*
***************************************************************************************************
*
*   FileName : eth_test.c
*
*   Copyright (c) Telechips Inc.
*
*   Description :
*
*
***************************************************************************************************
*/

#if ( MCU_BSP_SUPPORT_APP_SAMPLE_ETH == 1 )

#include <eth_test.h>
#ifdef OS_FREERTOS
#include "FreeRTOS.h"
#include "FreeRTOS_Sockets.h"
#include "FreeRTOS_IP.h"
#endif

/*
***************************************************************************************************
*                                          ETH_Test
* Function to test loopback via console command.
*
* @param    uiMode [in]       : Test mode
* @return
* Notes
*
***************************************************************************************************
*/

void ETH_TestSend
(
    uint32                              uiIdx
)
{
    static volatile const uint8                    ping_packet[ETH_MAX_PACKET_SIZE+1] =
    {
        0xf4 ,0xa8 ,0x0d ,0x22 ,0xac ,0xed ,    // Dst
        0x00 ,0x11 ,0x22 ,0x33 ,0x44 ,0x55 ,    // Src
        0x08 ,0x00 ,0x45 ,0x00,
        0x00 ,0xe4 ,0xb8 ,0xf0 ,0x00 ,0x00 ,0x80 ,0x01 ,0x00 ,0x00 ,
        0xc0 ,0xa8 ,0x01 ,0x66 , // Client IP : 192.168.1.102
        0xc0 ,0xa8, 0x01 ,0x64 , // Server IP : 192.168.1.100
        0x08 ,0x00 ,0x9f ,0xa2 ,0x00 ,0x01 ,0x1e ,0x1a ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66,
        0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75 ,0x76,
        0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f,
        0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75 ,0x76 ,0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68,
        0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75 ,0x76 ,0x77 ,0x61,
        0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71,
        0x72 ,0x73 ,0x74 ,0x75 ,0x76 ,0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a,
        0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75 ,0x76 ,0x77 ,0x61 ,0x62 ,0x63,
        0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73,
        0x74 ,0x75 ,0x76 ,0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c,
        0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75 ,0x76 ,0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65,
        0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e ,0x6f ,0x70 ,0x71 ,0x72 ,0x73 ,0x74 ,0x75,
        0x76 ,0x77 ,0x61 ,0x62 ,0x63 ,0x64 ,0x65 ,0x66 ,0x67 ,0x68 ,0x69 ,0x6a ,0x6b ,0x6c ,0x6d ,0x6e,
        0x6f ,0x70,
    }; // ICMP (ping) packet

    ETH_Send((uint8 *)ping_packet , uiIdx);
}

#define SIZEOFMACADDR                   (6)
#define SIZEOFIPV4ADDR                  (4)

void ETH_TestInit
(
    uint32                              uiMode
)
{
    ETH_CreateRecvTask(uiMode);
}

void ETH_TestIPInit
(
    void
)
{
    uint8 ucMacAddress[SIZEOFMACADDR] = {0, };
    uint8 ucIpAddress[SIZEOFIPV4ADDR] = {0, };
    uint8 ucNetMask[SIZEOFIPV4ADDR] = {255, 255, 255, 0}; // C Class For Testing.
    uint8 ucGatewayAddress[SIZEOFIPV4ADDR] = {192, 168, 0, 1 };
    uint8 ucDNSServerAddress[SIZEOFIPV4ADDR] = {10, 10, 10, 1};

    ucMacAddress[0] = 0x00;
    ucMacAddress[1] = 0x11;
    ucMacAddress[2] = 0x22;
    ucMacAddress[3] = 0x33;
    ucMacAddress[4] = 0x44;
    ucMacAddress[5] = 0x55;

    ucIpAddress[0] = 192;
    ucIpAddress[1] = 168;
    ucIpAddress[2] = 1;
    ucIpAddress[3] = 102;

    ucGatewayAddress[0] = ucIpAddress[0];
    ucGatewayAddress[1] = ucIpAddress[1];
    ucGatewayAddress[2] = ucIpAddress[2];
    ucGatewayAddress[3] = 1;


    FreeRTOS_IPInit(ucIpAddress, ucNetMask, ucGatewayAddress, ucDNSServerAddress, ucMacAddress);
}

void ETH_TestIperf
(
    void
)
{
    vIPerfInstall();
}
void ETH_TestLoopback
(
    uint32                              uiMode
)
{
    ETH_CreateRecvTask(uiMode);
}

#endif  // ( MCU_BSP_SUPPORT_APP_SAMPLE_ETH == 1 )

